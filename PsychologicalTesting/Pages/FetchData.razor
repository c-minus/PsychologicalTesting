@using Services.ConnersSelfEvaluationServiceNS
@using Services.ClipboardServiceNS
@using System.Text.Json

@page "/fetchdata"
@inject HttpClient Http
@inject IConnersSelfEvaluationService ConnerService
@inject IClipboardService ClipboardService

<PageTitle>Upload</PageTitle>

@if (snapshot == null)
{
    <p><em>Loading...</em></p>
}
else
{
    <button class="btn btn-primary" @onclick="CopyToClipboard">Copy</button>
    <div @onclick="CopyToClipboard">
        <span class="oi oi-clipboard oi-lg">Copy to clipboard</span>
    </div>
    <pre>
        @(JsonSerializer.Serialize(snapshot.States.LastOrDefault(), new JsonSerializerOptions() { WriteIndented = true }))
    </pre>
}

@code {
    private Snapshot? snapshot;

    protected override async Task OnInitializedAsync()
    {
        snapshot = ConnerService.Init();
    }

    private void CopyToClipboard()
    {
        var json = JsonSerializer.Serialize(snapshot.States.LastOrDefault(), new JsonSerializerOptions()
            {
                WriteIndented = true
            });

        ClipboardService.CopyToClipboard(json);
    }
}
